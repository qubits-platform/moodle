(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[437],{3437:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return z}});var s=n(5893),i=n(7294),o=n(7357),a=n(1536),l=n(3350),r=n(5861),d=n(3321),u=n(8456),c=n(655),p=n(4282),h=n(4613),f=n(4981);n(4007),n(9899),n(6395),n(7787);let g=e=>new Promise(t=>setTimeout(t,e));var m=void 0;sqlite3InitModule({print:console.log,printErr:console.error}).then(function(e){m=e});let b=async(e,t)=>{console.log(e);let n=await _(),s=n.oo1,i=new s.DB("/data.db","cw"),o=()=>{try{e.split("\n").forEach(e=>{if(e.startsWith("--"))return;let n=e.split(/\s/).slice(0,1)[0].toLowerCase();if("create"==n){i.exec(e);let n="created Table successfully";console.log(typeof n),t(n)}else if("insert"==n)i.exec(e),t("Inserted Data Successfully");else if("select"==n){let n=[],s=[];i.exec({sql:e,rowMode:"object",resultRows:n,columnNames:s}),s.join("");let o="";n.forEach(e=>{o+="<span>".concat(e.id," ").concat(e.name," ").concat(e.age,"</span> <br>")});let a="<span>".concat(s[0],"&nbsp;&nbsp;").concat(s[1],"&nbsp;&nbsp;").concat(s[2],"</span> <br>\n          <span>--------------</span><br>\n          ").concat(o).replace(/undefined/g,"");t(a)}else"delete"==n&&i.exec(e)})}catch(s){let e=s.message.split(":"),n="";for(let t=0;t<e.length;t++)n+=e[t];t(n)}},a=e.split("\n")[0];if(-1!=a.search("DATA")&&a.startsWith("--")){let e=a.split(":")[1].trim();y("./".concat(e),{headers:{"Content-Type":"text/plain"},method:"GET"}).then(e=>e.text()).then(e=>{e.split("\n").forEach(e=>{if(""!==(e=e.trim()))try{i.exec(e)}catch(e){console.log(e.message)}})}).then(()=>{o()}).catch(e=>alert("Unable to load data file: "+e.message))}else o()},y=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6e3;return Promise.race([fetch(e,t),new Promise((e,t)=>setTimeout(()=>t(Error("timeout")),n))])},_=async()=>{if(m)return m;await g(5e3).then(()=>{if(!m)throw Error("Sqlite didnt initialize.. reload your browser and try");return m})};var x="";let k=["Python initialization complete",'File "/',"CodeRunner","mod = compile","self.ast"],v=async e=>(""!=x&&(x=""),await loadPyodide({stdout:function(t){return S(t,e)}})),w=async(e,t,n)=>{let s=await v(t);try{let i=await s.loadPackagesFromImports(e);(i=await s.runPythonAsync(e))?N(i,t):""!==x?N(i,t):t(""),n(!0)}catch(e){n(!0),S(e.message,t)}};function S(e,t){e.split("\n").forEach(e=>{k.some(t=>e.includes(t))||N(e,t)})}function N(e,t){e&&t(x+=e+"\n")}let j=async(e,t,n)=>{w(e,t,n)},I=async(e,t,n)=>{try{let s=await loadPyodide({indexURL:"https://cdn.jsdelivr.net/pyodide/v0.21.3/full/"});await s.loadPackage("micropip");let i=s.pyimport("micropip");await i.install("https://cdn.jsdelivr.net/gh/qubits-platform/pytutor@master/dist/pytutor-1.0.0-py3-none-any.whl");let o=await s.runPythonAsync('import json\nfrom pytutor import generate_trace\ncode = """\n'.concat(e,'\n"""\ntrace = generate_trace.run_logger(code, "")\ntrace_dict = json.loads(trace)\njson.dumps(trace_dict, indent=2)\n'));o&&(n(""),t(JSON.parse(o)))}catch(e){console.log(e)}},F=async(e,t,n)=>{I(e,t,n)};var P=n(637);function C(e){let{content:t,language:n}=e,i=n?P.Z.highlight(n,t):P.Z.highlightAuto(t);return(0,s.jsx)("pre",{className:"hljs",children:(0,s.jsx)("code",{className:"language-".concat(n," hljs"),dangerouslySetInnerHTML:{__html:i.value}})})}var T=n(3894);let O=e=>'importScripts("'.concat(e,'");');var L=class{addCommand(e,t){this.commands[e]=t}stop(){null!=this.worker&&(this.worker.terminate(),this.worker=null,this.isRunning=!1,this.onTerminated&&this.onTerminated())}create(){this.stop();try{this.worker=new Worker(n.tu(new URL(n.p+n.u(330),n.b)))}catch(t){console.log(t);let e="data://application/javascript,".concat(O(this.workerURL),";");this.worker=new Worker(e)}this.isRunning=!1,this.worker.addEventListener("message",e=>{var t,n,s,i,o,a,l,r;switch(e.data.cmd){case"print":this.printToOutput(e.data.data);break;case"clear":this.clearOutput();break;case"figure":null===(t=this.onFigure)||void 0===t||t.call(this,e.data.data);break;case"dirty":null===(n=this.onDirtyFile)||void 0===n||n.call(this,e.data.data);break;case"file":null===(s=this.onReceivePyFile)||void 0===s||s.call(this,e.data.path,e.data.data);break;case"input":this.isRunning=!1,this.webworkerStatus="input",null===(i=this.onStatusChanged)||void 0===i||i.call(this,"input"),null===(o=this.onInput)||void 0===o||o.call(this,e.data.prompt);break;case"status":this.webworkerStatus=e.data.status,null===(a=this.onStatusChanged)||void 0===a||a.call(this,this.webworkerStatus);break;case"done":this.isRunning=!1,this.isSuspended=null!=e.data.suspendedAt,this.dbgCurrentLine=e.data.suspendedAt,this.webworkerStatus="idle",null===(l=this.onStatusChanged)||void 0===l||l.call(this,"done"),null===(r=this.onTerminated)||void 0===r||r.call(this);break;default:"cmd:"===e.data.cmd.slice(0,4)&&this.commands[e.data.cmd.slice(4)]&&this.commands[e.data.cmd.slice(4)](e.data.data)}}),this.worker.addEventListener("error",e=>{this.onError?this.onError(e):console.info(e)});let e={cmd:"config",options:{handleInput:!0,inlineInput:this.sharedOutput,preLoadedPackages:this.preLoadedPackages}};console.log("preloaded packages in PyWorker: ",this.preLoadedPackages),this.worker.postMessage(JSON.stringify(e))}handleTimeout(){this.maxTimeout>=0&&(this.timeoutId>=0&&clearTimeout(this.timeoutId),this.timeoutId=setTimeout(()=>{this.isRunning&&(this.stop(),this.onStatusChanged&&this.onStatusChanged("timeout"),this.onTimeout&&this.onTimeout()),this.timeoutId=-1},1e3*this.maxTimeout))}run(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];(null==this.worker||this.isRunning)&&this.create(),this.worker.postMessage(JSON.stringify(null!=e?{cmd:"run",code:e,breakpoints:t}:{cmd:"preload"})),this.isRunning=!0,this.handleTimeout()}submitInput(e){this.worker&&!this.isRunning&&(this.worker.postMessage(JSON.stringify({cmd:"submit",str:e})),this.isRunning=!0,this.handleTimeout())}cancelInput(){this.worker&&!this.isRunning&&(this.worker.postMessage(JSON.stringify({cmd:"cancel"})),this.webworkerStatus="",this.onStatusChanged&&this.onStatusChanged(""))}dbgResume(e){this.worker&&this.isSuspended&&(this.worker.postMessage(JSON.stringify({cmd:"debug",dbg:e})),this.isRunning=!0,this.handleTimeout())}getFile(e){var t;null===(t=this.worker)||void 0===t||t.postMessage(JSON.stringify({cmd:"get",path:e}))}putFile(e,t){var n;null===(n=this.worker)||void 0===n||n.postMessage(JSON.stringify({cmd:"put",path:e,data:t}))}preload(){this.run(null)}clearOutput(){this.sharedOutput||(this.outputBuffer=""),this.onOutput&&this.onOutput("",!1)}clearFigure(){var e;null===(e=this.worker)||void 0===e||e.postMessage(JSON.stringify({cmd:"clearFigure"}))}printToOutput(e){this.sharedOutput?this.onOutput&&this.onOutput(e,!0):(this.outputBuffer+=e,this.onOutput&&this.onOutput(this.outputBuffer,!1))}constructor(e){this.workerURL=e,this.worker=null,this.isRunning=!1,this.isSuspended=!1,this.maxTimeout=180,this.timeoutId=-1,this.outputBuffer="",this.sharedOutput=!1,this.dbgCurrentLine=null,this.preLoadedPackages=[],this.onError=null,this.onOutput=null,this.onInput=null,this.onFigure=null,this.onTimeout=null,this.onDirtyFile=null,this.onReceivePyFile=null,this.onStatusUpdate=null,this.onTerminated=null,this.commands={}}},E=n(948);let A=(0,E.ZP)("textarea")(e=>{let{theme:t}=e;return{fontFamily:"monospace",width:"100%",resize:"none",height:"auto",borderWidth:"0px",color:"inherit",backgroundColor:"inherit","&:focus-visible":{outline:"none"}}}),M=e=>{let{prompt:t,readOnly:n,onValidate:o,setprompt:a}=e;(0,i.useEffect)(()=>{d(l),(null==u?void 0:u.current)&&(u.current.style.height="auto",u.current.style.height="".concat(u.current.scrollHeight,"px"),u.current.focus(),u.current.setSelectionRange(t.length,t.length))},[t,n]);let l="",[r,d]=(0,i.useState)(l),u=(0,i.useRef)(null),c=(0,i.useRef)(null),p=e=>{let n=e.target.value.slice(t.length);d(n)},h=e=>{"Enter"===e.key&&(d(l),o(r),a(""))};return(0,s.jsx)("div",{ref:c,children:(0,s.jsx)(A,{readOnly:n,ref:u,onChange:p,onKeyDown:h,value:"".concat(t).concat(r),"data-gramm_editor":"false",spellCheck:"false"})})};var R=n(7922),q=n(4674),D=n(7085);let Z=i.forwardRef(function(e,t){return(0,s.jsx)(D.Z,{elevation:6,ref:t,variant:"filled",...e})});var U=n(6422),B=n(1955),G=n(3454);let J=e=>{let{output:t,code:n,getHints:o,getDebuggerStatus:a,getLog:u,IsErrorCatch:c,language:p}=e,[h,f]=(0,i.useState)();(0,i.useEffect)(()=>{f(B.Z.get("MoodleSession"))},[]);let g=async(e,t)=>{c(!0),a("loading");let n='\n        "The below given '.concat(p," program was executed and the output was observed. \n        First, workout your own solution to the problem based on the comments.\n        Then, analyze the output of the program and try to understand the error.\n        Your task is to:\n        * Provide hints on how to fix the error observed in the output and the fixed ").concat(p," code\n        * IF the program has logical errors, provide hints on how to fix the logical errors and the fixed ").concat(p,' code\n        \n        Your response should be in JSON.\n        Provide the output as JSON format with the following keys: "hints", "fixedCode".\n    \n        Program:\n        <start>\n        ').concat("".concat(t),"\n        <end>\n\n        Output:\n        <start>\n        ").concat("".concat(e),'\n        <end>\n        "');try{let e={method:"POST",headers:{"Content-Type":"application/json","x-moodle-session-key":h},body:JSON.stringify([{role:"system",content:"You are helping a student who is in 8th grade who is trying to learn programming"},{role:"user",content:n}])},t=await fetch(G.env.NEXT_PUBLIC_API_URL,e),s=await t.json(),i=JSON.parse(s.data);o(i),a("done")}catch(e){var s,i,l;c(!1),u(null==e?void 0:null===(s=e.response)||void 0===s?void 0:null===(i=s.data)||void 0===i?void 0:null===(l=i.error)||void 0===l?void 0:l.message)}};return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(l.Z,{title:(0,s.jsx)(r.Z,{fontSize:12,children:"AI Assistant"}),placement:"top",children:(0,s.jsx)(d.Z,{variant:"outlined",endIcon:(0,s.jsx)(U.Z,{}),className:"ai-help-button",onClick:()=>g(t,n)})})})};function z(e){let{dataChage:t,value:g,language:m,editable:y,uniqID:_,input:x,handleReset:k,visualization:v,reset:w,className:S,gutter:N,pytutorReset:I,setpytutorReset:P,theme:O,consoleReset:E,setConsoleReset:A}=e,[D,U]=(0,i.useState)(null),[B,G]=(0,i.useState)(""),[z,V]=(0,i.useState)(!1),[W,Y]=(0,i.useState)(!1);(0,i.useEffect)(()=>{if(x){let e=n(2135),t=new L(e);U(t),t.onOutput=e=>{Q(e)},t.onInput=e=>{V(!0),G(e)}}},[x]);let H=e=>{D&&(D.submitInput(e),V(!1))},K=e=>{D.run(e),D.clearOutput(),Y(!0)},[$,Q]=(0,i.useState)(""),[X,ee]=(0,i.useState)(""),[et,en]=(0,i.useState)(!1),[es,ei]=(0,i.useState)(!1),[eo,ea]=(0,i.useState)(!1),[el,er]=(0,i.useState)(""),[ed,eu]=(0,i.useState)(!1),[ec,ep]=(0,i.useState)(!1),[eh,ef]=(0,i.useState)(""),[eg,em]=(0,i.useState)(),[eb,ey]=(0,i.useState)(!1),[e_,ex]=(0,i.useState)(!0),ek=e=>{try{let t=ev(()=>{Function(e)()});Q(t),ey(!0)}catch(e){Q("Error: ".concat(e.message))}},ev=e=>{let t=console.log,n="";return console.log=e=>{n+=e+"\n"},e(),console.log=t,n},ew=async(e,t)=>{en(!0),ea(!1),er(""),Q("Running..."),ef(""),ep(!1),"python"!==t||(x&&(A(!0),K(e),ey(!0),ei(!0)),x||(A(!0),j(e,Q,ey))),"sql"===t&&(b(e,Q),ey(!0)),"javascript"===t&&ek(e),en(!1)},eS=e=>{P(!0),ep(!1),en(!0),ea(!1),F(e,ee,Q)};(0,i.useEffect)(()=>{var e,t,n,s;!X||(null===(e=X.trace)||void 0===e?void 0:e[0].exception_msg)?X&&(null===(t=X.trace)||void 0===t?void 0:t[0].exception_msg)&&(en(!1),ef(null===(s=X.trace)||void 0===s?void 0:s[0].exception_msg),ep(!0)):(n=new ExecutionVisualizer("TraceBlock"+_,X,{debugMode:!1,showAllFrameLabels:!0,lang:"py3",highlightLines:!0,arrowLines:!1,verticalStack:!0}),en(!1),n.redrawConnectors())},[X]),(0,i.useEffect)(()=>{$&&$.search("Traceback")&&ei(!0)},[$]),(0,i.useEffect)(()=>{},[el]);let eN=()=>(0,s.jsx)(o.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"center",mt:2},children:(0,s.jsx)(u.Z,{})}),ej=()=>{ep(!1)},eI=e=>{ep(!1),e&&(ea(!0),ep(!1),ef(""),eu(!1),em(e.hints),er(e))},eF=()=>{eu(e=>!e)},eP=e=>{ep(!1),"loading"===e?(er(""),ea(!0)):"done"===e&&en(!1)},eC=e=>{ef("Error Occurred while trying to get hints. Please retry"),ep(!0)};return(0,s.jsxs)("div",{className:"editor-container",children:[!y&&(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(f.ZP,{mode:m,highlightActiveLine:!1,id:1,value:g,maxLines:50,showGutter:N,fontSize:14,editorProps:{$blockScrolling:!1},onChange:t,width:"100%",readOnly:y,height:"100%",className:S,theme:!!O&&"dracula"})}),y&&(0,s.jsx)(C,{language:m,content:g}),(0,s.jsx)(o.Z,{spacing:3,className:"button-toolbar",children:(0,s.jsxs)(a.Z,{direction:"row",gap:1,sx:{justifyContent:"flex-end"},children:[(0,s.jsx)(l.Z,{title:(0,s.jsx)(r.Z,{fontSize:12,children:"Run"}),placement:"top",children:(0,s.jsx)(d.Z,{variant:"outlined",endIcon:(0,s.jsx)(c.Z,{}),onClick:()=>ew(g,m),className:"tool-button"})}),w&&(0,s.jsx)(l.Z,{title:(0,s.jsx)(r.Z,{fontSize:12,children:"Reset"}),placement:"top",children:(0,s.jsx)(d.Z,{variant:"outlined",endIcon:(0,s.jsx)(p.Z,{}),onClick:()=>k(_),className:"tool-button"})}),v&&(0,s.jsx)(l.Z,{title:(0,s.jsx)(r.Z,{fontSize:12,children:"Debug"}),placement:"top",children:(0,s.jsx)(d.Z,{variant:"outlined",endIcon:(0,s.jsx)(h.Z,{}),onClick:()=>eS(g),className:"tool-button"})})]})}),(x&&W||$&&!x)&&(0,s.jsxs)("div",{className:"console-wrapper",children:[es&&eb&&E&&(0,s.jsx)(J,{output:$,code:g,getHints:eI,getDebuggerStatus:eP,getLog:eC,setShowAIDebugBtn:ey,IsErrorCatch:ex,language:m}),x&&W&&(0,s.jsx)("div",{className:"resultTextareaStyle w-100",children:(0,s.jsx)(M,{onValidate:H,prompt:$+(z?B:""),readOnly:!z,setprompt:G})}),$&&!x&&E&&(0,s.jsx)("code",{className:"resultTextareaStyle w-100",readOnly:!0,children:"python"===m?(0,s.jsx)("pre",{children:$}):(0,T.ZP)($)})]}),eo&&(0,s.jsx)(s.Fragment,{children:el.hints?(0,s.jsx)("div",{className:"ai-console-wrapper",children:(0,s.jsxs)("div",{className:"resultTextareaStyleerror",children:[" ",(0,s.jsx)(d.Z,{variant:"outlined",className:"chatgptbtn",onClick:()=>eF(),children:"Fix Code"})," ",(0,s.jsx)("div",{className:"hintstyle",children:"object"==typeof eg?(0,s.jsx)("ul",{children:null==eg?void 0:eg.map((e,t)=>(0,s.jsx)("li",{children:e},t))}):"string"==typeof eg&&(0,s.jsx)("ul",{children:(0,s.jsx)("li",{children:eg})})}),(0,s.jsx)("br",{}),ed&&(0,s.jsx)("div",{children:(0,s.jsx)(f.ZP,{mode:m,highlightActiveLine:!1,value:el.fixedCode,maxLines:50,showGutter:!1,fontSize:14,editorProps:{$blockScrolling:!1},width:"100%",readOnly:!0,height:"100%"})})," "]})}):e_&&(0,s.jsx)(eN,{})}),X&&!eo&&!eh&&I&&(0,s.jsx)("div",{id:"TraceBlock"+_,className:"traceBlockStyle w-100"}),et&&(0,s.jsx)(eN,{}),X&&(0,s.jsx)("div",{id:"TraceBlock"+_}),(0,s.jsx)("div",{className:"alert-collapse",children:(0,s.jsx)(R.Z,{in:ec,sx:{mt:2},children:(0,s.jsx)(Z,{severity:"error",action:(0,s.jsx)(q.Z,{"aria-label":"close",color:"inherit",size:"small",onClick:()=>ej()}),children:eh})})})]})}},2135:function(){let e="https://cdn.jsdelivr.net/pyodide/v0.21.3/full/";class t{static create(){return self.sessionStorage?new s:new n}}class n extends t{getDir(){return Object.keys(this.fs)}getFile(e){return this.fs[e]}setFile(e,t){this.fs[e]=t}constructor(){super(),this.fs={}}}class s extends t{getDir(){return Object.keys(self.sessionStorage)}getFile(e){return self.sessionStorage.getItem(e)}setFile(e,t){self.sessionStorage.setItem(e,t)}}class i{load(e){this.notifyStatus("loading Pyodide "+this.pyodideVersion),globalThis.loadPyodide({indexURL:this.pyodideURL}).then(t=>{this.pyodide=t,this.pyodideVersion=t.version,this.notifyStatus("setup"),self.pyodideGlobal={requestModule:e=>this.requestModule(e),fs:this.fs,markFileDirty:e=>this.markFileDirty(e),setDbgCurrentLine:e=>{this.dbgCurrentLine=e}},this.preLoadedPackages.forEach(e=>{this.notifyStatus("pre-loading "+e),this.pyodide.loadPackage(e).then(()=>{this.loadedModuleNames.push(e),this.notifyStatus(e+" pre-loaded")}).catch(t=>{this.failedModuleNames.push(e),this.notifyStatus("error pre-loading "+e+t)})}),this.pyodide.runPython('\n                import sys\n                import io\n                from js import pyodideGlobal\n\n                class __ImportIntercept:\n                    def find_spec(self, name, path, module):\n                        pyodideGlobal.requestModule(name)\n                sys.meta_path.append(__ImportIntercept())\n\n                class MyTextFile(io.StringIO):\n                    def __init__(self, filename, mode="r"):\n                        self.filename = filename\n                        self.readOnly = mode == "r"\n                        content = pyodideGlobal.fs.getFile(filename)\n                        if content is None:\n                            if self.readOnly:\n                                raise FileNotFoundError(filename)\n                            content = ""\n                        else:\n                            if mode == "w":\n                                content = ""\n                            elif mode == "x":\n                                raise FileExistsError(filename)\n                        super().__init__(content if content is not None else "")\n                        if mode == "a":\n                            self.seek(0, 2)\n                    def close(self):\n                        if not self.readOnly:\n                            content = self.getvalue()\n                            pyodideGlobal.fs.setFile(self.filename, content)\n                            pyodideGlobal.markFileDirty(self.filename)\n                            super().close()\n\n                def open(filename, mode="r", encoding=None):\n                    return MyTextFile(filename, mode)\n\n                import os\n\n                def __os_listdir(path="."):\n                    return list(pyodideGlobal.fs.getDir())\n                os.listdir = __os_listdir\n\n                # user code execution\n                global_variables = {\n                    "open": open,\n                    "input": input\n                }\n\n                # global debugger\n                dbg = None\n\n                def execute_code(src, breakpoints=None):\n                    """Return 0 if done, 1 if suspended in debugger, 2 if waiting for input"""\n\n                    class Dbg:\n\n                        import sys\n                        import os\n                        import re\n\n                        class Suspended(Exception):\n                            pass\n\n                        class SuspendedForInput(Suspended):\n                            pass\n\n                        def __init__(self, interactive=True):\n                            self.interactive = interactive\n                            self.frame = None\n\n                            # breakpoint line numbers\n                            self.breakpoints = set()\n                            self.break_at_start = True\n                            # past actions or inputs from the user\n                            # ("c"=continue, "n"=next, "s"=step, "r"=return, etc.)\n                            # resume will execute them and suspend execution when they are exhausted\n                            self.debug_action_history = []\n                            # True to ignore trace calls until 2nd event="call"\n                            self.ignore_top_call = False\n                            # substitution for input global function\n                            self.input_debug = None\n\n                            self.last_command = ""\n\n                            self.init_output()\n                            self.null = open(self.os.devnull, "w")\n\n                        def init_output(self):\n                            self.stdout = self.sys.stdout\n                            self.stderr = self.sys.stderr\n\n                        def enable_print(self, on):\n                            self.sys.stdout = self.stdout if on else self.null\n                            self.sys.stderr = self.stderr if on else self.null\n\n                        def clear_breakspoints(self):\n                            self.breakpoints = set()\n\n                        def set_breakpoint(self, lineno):\n                            self.breakpoints.add(lineno)\n\n                        def clear_breakspoint(self, lineno):\n                            self.breakpoints.remove(lineno)\n\n                        def is_suspended(self):\n                            return self.frame is not None\n\n                        def is_requesting_input(self):\n                            return self.request_input\n\n                        def debug_(self, fun, ignore_top_call, args, kwargs):\n                            self.fun = fun\n                            self.args = args\n                            self.kwargs = kwargs\n                            self.ignore_top_call = ignore_top_call\n                            self.returned_value = None\n                            self.debug_action_history = []\n                            self.resume(None)\n                            if self.interactive:\n                                self.cli()\n\n                        def debug_call(self, fun, *args, **kwargs):\n                            self.debug_(fun, False, args, kwargs)\n\n                        def debug_code(self, code, globals=globals(), locals=None):\n                            def input(prompt):\n                                return self.input_debug(prompt)\n                            globals["input"] = input\n                            self.debug_(lambda: exec(code, globals, locals), True, (), {})\n\n                        def resume(self, cmd):\n                            if cmd is not None:\n                                self.debug_action_history.append(cmd)\n\n                            # state ("s"=step, "n"=next, "r"=return, "c"=continue)\n                            state = "s" if self.break_at_start else "c"\n                            # index of first action in self.debug_action_history to perform\n                            action_count = 0\n                            # call depth used for "n" and "r"\n                            call_depth = 0\n                            last_break_depth = 0\n                            # number of event "call"\n                            call_count = 0\n\n                            def trace(frame, event, arg):\n                                nonlocal state, action_count, call_depth, last_break_depth, call_count\n                                if self.ignore_top_call:\n                                    if event == "call":\n                                        if frame.f_code.co_name == "input":\n                                            if action_count >= len(self.debug_action_history):\n                                                # call to input(prompt): display prompt and request user input\n                                                if frame.f_locals["prompt"] is not None:\n                                                    self.sys.stdout.write(frame.f_locals["prompt"])\n                                                self.frame = frame\n                                                raise self.SuspendedForInput()\n                                            else:\n                                                # execute input() defined below (picks input in self.debug_action_history)\n                                                pass\n                                        call_count += 1\n                                        call_depth += 1\n                                    if call_count < 2:\n                                        return\n                                if event == "line":\n                                    self.current_line = frame.f_lineno\n                                    if (state == "n" and call_depth <= last_break_depth or\n                                        state == "r" and call_depth < last_break_depth or\n                                        state == "s" or\n                                        frame.f_lineno in self.breakpoints):\n                                        # breakpoint (explicit, or following s/n/r which should break here)\n                                        if action_count >= len(self.debug_action_history):\n                                            # not reached yet: really break here\n                                            self.frame = frame\n                                            raise self.Suspended()\n                                        else:\n                                            # already reached: continue\n                                            state = self.debug_action_history[action_count]\n                                            action_count += 1\n                                            last_break_depth = call_depth\n                                            if action_count >= len(self.debug_action_history):\n                                                self.enable_print(True)\n                                    elif action_count >= len(self.debug_action_history):\n                                        self.enable_print(True)\n                                elif event == "call":\n                                    call_depth += 1\n                                elif event == "return":\n                                    call_depth -= 1\n                                return trace\n\n                            def input(prompt):\n                                nonlocal action_count\n                                str = self.debug_action_history[action_count]\n                                action_count += 1\n                                return str\n                            self.input_debug = input\n\n                            suspended = False\n                            self.request_input = False\n                            self.enable_print(len(self.debug_action_history) <= 1)\n                            self.sys.settrace(trace)\n                            try:\n                                self.returned_value = self.fun(*self.args, **self.kwargs)\n                            except self.SuspendedForInput:\n                                suspended = True\n                                self.request_input = True\n                            except self.Suspended:\n                                suspended = True\n                            finally:\n                                self.sys.settrace(None)\n                                self.enable_print(True)\n                            if not suspended:\n                                self.frame = None\n\n                        def eval_code(self, src):\n                            try:\n                                code = compile(src, "<stdin>", "single")\n                                exec(code,\n                                     self.frame.f_globals,\n                                     self.frame.f_locals)\n                            except Exception as e:\n                                import traceback\n                                traceback.print_exception(etype=type(e),\n                                                          value=e,\n                                                          tb=e.__traceback__)\n\n                        def exec_cmd(self, cmd):\n                            cmd = cmd.strip() or self.last_command\n                            r = self.re.compile(r"^(S+)(s+(S+))$")\n                            match = r.match(cmd)\n                            if match:\n                                cmd0 = match.groups()[0]\n                                arg = match.groups()[2]\n                            else:\n                                cmd0 = cmd\n                                arg = None\n                            if cmd0 in ["b", "break"]:\n                                if arg is None:\n                                    print(self.breakpoints)\n                                else:\n                                    try:\n                                        lineno = int(arg)\n                                        self.set_breakpoint(lineno)\n                                    except:\n                                        print("Bad line number")\n                                self.last_command = ""\n                            elif cmd in ["c", "continue"]:\n                                self.resume("c")\n                                self.last_command = cmd\n                            elif cmd0 in ["cl", "clear"]:\n                                if arg:\n                                    try:\n                                        lineno = int(arg)\n                                        self.clear_breakspoint(lineno)\n                                    except:\n                                        print("Bad line number")\n                                else:\n                                    self.clear_breakspoints()\n                                self.last_command = ""\n                            elif cmd in ["h", "help"]:\n                                import textwrap\n                                print(textwrap.dedent("""\n                                    b(reak) line  break at specified line\n                                    c(ontinue)    continue\n                                    cl(ear)       clear all breakpoints\n                                    h(elp)        help\n                                    q(quit)       quit\n                                    r(eturn)      continue until the current function returns\n                                    s(tep)        step\n                                    w(here)       display a stack trace\n                                    expr          evaluate expression, including local and global variables\n                                    """))\n                                self.last_command = ""\n                            elif cmd in ["q", "quit"]:\n                                self.frame = None\n                            elif cmd in ["n", "next"]:\n                                self.resume("n")\n                                self.last_command = cmd\n                            elif cmd in ["r", "return"]:\n                                self.resume("r")\n                                self.last_command = cmd\n                            elif cmd in ["s", "step"]:\n                                self.resume("s")\n                                self.last_command = cmd\n                            elif cmd in ["w", "where"]:\n                                frame = self.frame\n                                while frame and (frame.f_code.co_name != "resume"):\n                                    print(f"{frame.f_code.co_name} at line {frame.f_lineno}")\n                                    frame = frame.f_back\n                            elif cmd != "":\n                                self.eval_code(cmd)\n\n                            # return true when execution is completed\n                            return self.frame is None\n\n                        def submit_input(self, input):\n                            self.debug_action_history.append(input)\n                            self.resume(None)\n\n                        def cli(self):\n                            while self.is_suspended():\n                                cmd = input(f"{self.frame.f_code.co_name}:{self.frame.f_lineno} dbg> ")\n                                self.exec_cmd(cmd)\n\n                    try:\n                        code = compile(src, "<stdin>", mode="single")\n                    except SyntaxError:\n                        code = compile(src, "<stdin>", mode="exec")\n\n                    if breakpoints:\n                        global dbg\n                        dbg = Dbg(False)\n                        dbg.break_at_start = False;\n                        for breakpoint in breakpoints:\n                            dbg.set_breakpoint(breakpoint)\n                        dbg.debug_code(code, globals=global_variables)\n                        return 0 if not dbg.is_suspended() else 2 if dbg.request_input else 1\n                    else:\n                        exec(code, global_variables)\n                        return 0\n\n                def continue_debugging(dbg_command):\n                    if dbg is not None and dbg.is_suspended():\n                        dbg.init_output()  # can be a new io.StringIO() object\n                        dbg.exec_cmd(dbg_command)\n                        return 0 if not dbg.is_suspended() else 2 if dbg.request_input else 1\n\n                def submit_input_to_debugger(input):\n                    if dbg is not None and dbg.is_suspended() and dbg.request_input:\n                        dbg.init_output()  # can be a new io.StringIO() object\n                        dbg.submit_input(input)\n                        return 0 if not dbg.is_suspended() else 2 if dbg.request_input else 1\n\n                def debug_current_line():\n                    return dbg.current_line if dbg and dbg.is_suspended() else None\n            '),e&&e()})}requestModule(e){0>this.requestedModuleNames.indexOf(e)&&0>this.loadedModuleNames.indexOf(e)&&0>this.failedModuleNames.indexOf(e)&&this.requestedModuleNames.push(e)}markFileDirty(e){0>this.dirtyFiles.indexOf(e)&&(this.dirtyFiles.push(e),this.notifyDirtyFile(e))}getDirtyFilePaths(e){let t=this.dirtyFiles;return e&&(this.dirtyFiles=[]),t}run(e,t){if(""===e.trim())return!0;this.pyodide.runPython("\n            import io, sys\n            sys.stdout = io.StringIO()\n            sys.stderr = sys.stdout\n        "),this.loadedModuleNames.indexOf("matplotlib")>=0&&this.pyodide.runPython('\n                import matplotlib\n                matplotlib.use("Agg")\n            '),this.handleInput&&this.pyodide.runPython('\n                class CodeWithInputEvaluator:\n\n                    def __init__(self, src, global_variables):\n\n                        import ast\n\n                        def check_node(node, block_reason=None):\n                            """Check that input function is called only from where it is supported,\n                            i.e. at top-level if block_reason is None, not in functions or methods, and\n                            nowhere if block_reason is a string describing the offending context. Raise\n                            an exception otherwise.\n                            """\n                            if type(node) is ast.ClassDef:\n                                block_reason = "class"\n                            elif type(node) is ast.FunctionDef:\n                                block_reason = "def"\n                            elif type(node) is ast.Lambda:\n                                block_reason = "lambda"\n                            elif block_reason and type(node) is ast.Call and type(node.func) is ast.Name and node.func.id == "input":\n                                raise Exception(f"input call not supported in {block_reason} at line {node.lineno}")\n                            for child in ast.iter_child_nodes(node):\n                                check_node(child, block_reason)\n\n                        def check(src):\n                            """Check that input function is called only from where it is supported,\n                            i.e. at top-level, not in functions or methods. Raise an exception otherwise.\n                            """\n                            root = ast.parse(src)\n                            check_node(root)\n\n                        def replace_input_with_yield(src, function_name, global_var_names=[]):\n\n                            """Compile source code and replace input calls with yield.\n                            """\n                            class Replacer(ast.NodeTransformer):\n                                """NodeTransformer which replaces input(prompt) with\n                                yield((False,prompt,locals()))\n                                """\n                                def visit_Call(self, node):\n                                    self.generic_visit(node)\n                                    if type(node.func) is ast.Name and node.func.id == "input":\n                                        input_arg = node.args[0] if len(node.args) > 0 else ast.NameConstant(value=None)\n                                        y = ast.Yield(value=ast.Tuple(\n                                            elts=[\n                                                ast.NameConstant(value=False),\n                                                input_arg,\n                                                ast.Call(func=ast.Name(id="locals", ctx=ast.Load()), args=[], keywords=[])\n                                            ],\n                                            ctx=ast.Load()\n                                        ))\n                                        return y\n                                    return node\n\n                            # compile to ast\n                            root = ast.parse(src)\n\n                            # check that input is called only from top-level code, not functions\n                            check_node(root)\n\n                            # replace input(prompt) with yield (False,prompt,locals())\n                            replacer = Replacer()\n                            root1 = replacer.visit(root)\n\n                            # replace last statement with "import sys; sys.displayhook(expr)" if it is an expr\n                            last_el = root1.body[-1]\n                            if type(last_el) is ast.Expr:\n                                expr = root1.body.pop()\n                                root1.body.append(ast.Import(\n                                    names=[\n                                        ast.alias(name="sys", asname=None)\n                                    ]\n                                ))\n                                root1.body.append(ast.Expr(\n                                    value=ast.Call(\n                                        func=ast.Attribute(attr="displayhook", value=ast.Name(id="sys", ctx=ast.Load()), ctx=ast.Load()),\n                                        args=[expr.value],\n                                        keywords=[]\n                                    )\n                                ))\n\n                            # append yield (True,None,locals())\n                            y = ast.Expr(\n                                value=ast.Yield(value=ast.Tuple(\n                                    elts=[\n                                        ast.NameConstant(value=True),\n                                        ast.NameConstant(value=None),\n                                        ast.Call(func=ast.Name(id="locals", ctx=ast.Load()), args=[], keywords=[])\n                                    ],\n                                    ctx=ast.Load()\n                                ))\n                            )\n                            root1.body.append(y)\n\n                            # define a coroutine\n                            root1.body = [\n                                ast.FunctionDef(\n                                    name=function_name,\n                                    args=ast.arguments(\n                                        posonlyargs=[],\n                                        args=[ast.arg(arg=g, annotation=None) for g in global_var_names],\n                                        defaults=[],\n                                        kwarg=None,\n                                        kw_defaults=[],\n                                        kwonlyargs=[],\n                                        vararg=None\n                                    ),\n                                    body=root1.body,\n                                    decorator_list=[],\n                                    returns=None\n                                )\n                            ]\n\n                            # add dummy missing lineno and col_offset to make compiler happy\n                            for node in ast.walk(root1):\n                                if not hasattr(node, "lineno"):\n                                    node.lineno = 1\n                                if not hasattr(node, "col_offset"):\n                                    node.col_offset = 999\n\n                            # compile\n                            code = compile(root1, "<ast>", "exec")\n\n                            return code\n\n                        def run_code_with_input_as_coroutine(src, global_variables):\n                            code = replace_input_with_yield(src, "corout", global_variables)\n                            gl = {}\n                            exec(code, gl)\n                            co = gl["corout"](**global_variables)\n                            return co\n\n                        self.global_variables = global_variables\n                        self.co = run_code_with_input_as_coroutine(src, global_variables)\n                        self.done, self.prompt, new_global_variables = self.co.send(None)\n                        self.global_variables.update(new_global_variables)\n\n                    def submit_input(self, input):\n                        self.done, self.prompt, new_global_variables = self.co.send(input)\n                        self.global_variables.update(new_global_variables)\n\n                    def cancel_input(self):\n                        self.co.close()\n            ');let n="";this.requestedModuleNames=[],this.suspended=!1,this.dbgCurrentLine=null;try{if(this.notifyStatus("running"),self.pyodideGlobal.setFigureURL=e=>this.setFigureURL(e),this.pyodide.globals.set("src",e),t&&t.length>0){let e="["+t.map(e=>e.toString(10)).join(", ")+"]";this.pyodide.runPython("\n                    import js\n                    status = execute_code(src, breakpoints=".concat(e,")\n                    suspended = status != 0\n                    done = not suspended\n                    js.pyodideGlobal.setDbgCurrentLine(debug_current_line())\n                ")),this.suspended=this.pyodide.globals.get("suspended"),this.requestInput=2===this.pyodide.globals.get("status"),this.inputPrompt=null}else this.handleInput?(this.pyodide.runPython("evaluator = CodeWithInputEvaluator(src, global_variables)"),this.requestInput=!1,this.pyodide.runPython("\n                    done = evaluator.done\n                    suspended = False\n                    # suspended = evaluator.suspended\n                    input_prompt = evaluator.prompt\n                "),this.pyodide.globals.get("done")||this.pyodide.globals.get("suspended")||(this.inputPrompt=this.pyodide.globals.get("input_prompt"),this.requestInput=!0)):this.pyodide.runPython("execute_code(src); done = True; suspended = False");this.loadedModuleNames.indexOf("matplotlib")>=0&&this.pyodide.runPython('\n                    import matplotlib.pyplot, io, base64, js\n                    if matplotlib.pyplot.get_fignums():\n                        with io.BytesIO() as buf:\n                            matplotlib.pyplot.savefig(buf, format="png")\n                            buf.seek(0)\n                            js.pyodideGlobal.setFigureURL("data:image/png;base64," +\n                                base64.b64encode(buf.read()).decode("ascii"))\n                ')}catch(t){if(/ModuleNotFoundError/.test(t.message)&&this.requestedModuleNames.length>0){let t=this.requestedModuleNames.shift();return this.notifyStatus("loading module "+t),this.pyodide.loadPackage(t).then(()=>{this.loadedModuleNames.push(t),this.notifyStatus("running"),this.run(e)}).catch(()=>{this.failedModuleNames.push(t),this.postExec&&this.postExec()}),!1}n=t.message,this.pyodide.globals.set("done",!0)}let s=this.pyodide.runPython("sys.stdout.getvalue()");return this.write(s+n),this.pyodide.globals.get("done")||this.pyodide.globals.get("suspended")||!this.inlineInput||this.write(null==this.inputPrompt?"? ":this.inputPrompt),this.postExec&&this.postExec(),!0}submitInput(e){if(this.requestInput){this.pyodide.runPython("\n                import io, sys\n                sys.stdout = io.StringIO()\n                sys.stderr = sys.stdout\n            "),this.inlineInput||this.write((null==this.inputPrompt?"? ":this.inputPrompt)+e+"\n"),this.requestInput=!1,self.input_string=e;let t="";if(this.suspended)try{this.pyodide.runPython("\n                        import js\n                        status = submit_input_to_debugger(js.input_string)\n                        suspended = status != 0\n                        done = not suspended\n                        js.pyodideGlobal.setDbgCurrentLine(debug_current_line())\n                    "),this.suspended=this.pyodide.globals.get("suspended"),this.requestInput=2==this.pyodide.globals.get("status"),this.inputPrompt=null}catch(e){}else try{this.pyodide.runPython("\n                        import js\n                        evaluator.submit_input(js.input_string)\n                        done = evaluator.done\n                        # suspended = evaluator.suspended\n                        input_prompt = evaluator.prompt\n                    "),this.pyodide.globals.get("done")||this.pyodide.globals.get("suspended")||(this.inputPrompt=this.pyodide.globals.get("input_prompt"),this.requestInput=!0)}catch(e){t=e.message,this.pyodide.globals.set("done",!0)}let n=this.pyodide.runPython("sys.stdout.getvalue()");this.write(n+t),this.pyodide.globals.get("done")||this.pyodide.globals.get("suspended")||!this.inlineInput||this.write(null==this.inputPrompt?"? ":this.inputPrompt),this.postExec&&this.postExec()}}cancelInput(){if(this.requestInput){this.requestInput=!1;try{this.pyodide.runPython("evaluator.cancel_input()")}catch(e){}this.dbgCurrentLine=null}}continueDebugging(e){this.pyodide.runPython("import io, syssys.stdout = io.StringIO()sys.stderr = sys.stdout");try{self.dbg_command=e,this.pyodide.runPython("\n                import js\n                status = continue_debugging(js.dbg_command)\n                suspended = status != 0\n                done = not suspended\n                js.pyodideGlobal.setDbgCurrentLine(debug_current_line())\n            "),this.suspended=this.pyodide.globals.get("suspended"),this.requestInput=2==this.pyodide.globals.get("status"),this.inputPrompt=null}catch(e){}let t=this.pyodide.runPython("sys.stdout.getvalue()");this.write(t),this.pyodide.globals.get("done")||this.pyodide.globals.get("suspended")||!this.inlineInput||this.write(null==this.inputPrompt?"? ":this.inputPrompt),this.postExec&&this.postExec()}clearFigure(){this.loadedModuleNames.indexOf("matplotlib")>=0&&(this.pyodide.runPython("\n                import matplotlib.pyplot\n                matplotlib.pyplot.close()\n            "),this.setFigureURL("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII="))}clear(){this.clearText(),this.clearFigure()}constructor(n){this.pyodide=null,this.postExec=n&&n.postExec||(()=>{}),this.write=n&&n.write||(e=>{}),this.clearText=n&&n.clearText||(()=>{}),this.setFigureURL=n&&n.setFigureURL||(e=>{}),this.notifyDirtyFile=n&&n.notifyDirtyFile||(e=>{}),this.notifyStatus=n&&n.notifyStatus||(e=>{}),this.handleInput=n&&n.handleInput||!1,this.inlineInput=n&&n.inlineInput||!1,this.pyodideURL=n&&n.pyodideURL||e;var s=/\/(v[\d.]+)\//.exec(this.pyodideURL);this.pyodideVersion=s?s[1]:"",this.requestInput=!1,this.inputPrompt=null,this.suspended=!1,this.dbgCurrentLine=null,this.preLoadedPackages=null==n?void 0:n.preLoadedPackages,this.requestedModuleNames=[],this.loadedModuleNames=[],this.failedModuleNames=[],this.fs=t.create(),this.dirtyFiles=[]}}var o=!1;let a=!1,l="",r=-1;var d=null;function u(e,t){postMessage({cmd:"status",status:t&&t.length>0?"debugging":"running"}),d.run(e,t)}onmessage=t=>{var n,s;function c(t){let n={write:e=>{l+=e},clearText:()=>{l="",a=!0},setFigureURL:e=>{postMessage({cmd:"figure",data:e})},notifyStatus:e=>{postMessage({cmd:"status",status:e})},notifyDirtyFile:e=>{postMessage({cmd:"dirty",data:e})},postExec:function(){let e;(r=e=Date.now())<0?r=e+10:r<=e&&(a&&(postMessage({cmd:"clear"}),a=!1),l&&(postMessage({cmd:"print",data:l}),l=""),r=-1),postMessage({cmd:"done",suspendedAt:d.suspended?d.dbgCurrentLine:null}),d.requestInput&&postMessage({cmd:"input",prompt:d.inputPrompt})},handleInput:t&&t.handleInput||!1,inlineInput:t&&t.inlineInput||!1,preLoadedPackages:(null==t?void 0:t.preLoadedPackages)||[],pyodideURL:e};console.log("options inside worker: ",n),d=new i(n)}let p=JSON.parse(t.data);if("config"===p.cmd)c(p.options);else switch(null==d&&c(),p.cmd){case"preload":postMessage({cmd:"status",status:"startup"}),d.load(()=>{o=!0,postMessage({cmd:"done"})});break;case"run":o?u(p.code,p.breakpoints):(postMessage({cmd:"status",status:"startup"}),d.load(()=>{u(p.code,p.breakpoints),o=!0}));break;case"submit":n=p.str,d.submitInput(n,s);break;case"cancel":d.cancelInput();break;case"debug":if(o&&d.suspended)switch(p.dbg){case"next":case"step":case"return":case"continue":case"quit":d.continueDebugging(p.dbg)}else postMessage({cmd:"done"});break;case"get":postMessage({cmd:"file",path:p.path,data:d.fs.getFile(p.path)});break;case"put":d.fs.setFile(p.path,p.data);break;case"clearFigure":d.clearFigure()}}}}]);